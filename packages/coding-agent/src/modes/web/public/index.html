<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
		<title>pi --mode web</title>
		<link rel="stylesheet" href="/vendor/xterm.css" />
		<style>
			:root {
				--bg: #0a0f1a;
				--panel: #111827;
				--line: #273245;
				--text: #e5e7eb;
				--muted: #93a0b7;
				--good: #34d399;
				--bad: #f87171;
				--app-height: 100vh;
			}
			* {
				box-sizing: border-box;
				min-width: 0;
			}
			html,
			body {
				width: 100%;
				height: 100%;
				margin: 0;
				overflow: hidden;
				overscroll-behavior: none;
			}
			body {
				background: radial-gradient(1200px 700px at 10% -10%, #1e3a8a33 0%, var(--bg) 45%);
				color: var(--text);
				font-family:
					"Iosevka Web",
					"JetBrains Mono",
					"SFMono-Regular",
					Menlo,
					monospace;
				-webkit-text-size-adjust: 100%;
			}
			main {
				width: 100%;
				max-width: 100vw;
				height: var(--app-height);
				padding: max(6px, env(safe-area-inset-top)) max(8px, env(safe-area-inset-right))
					calc(8px + env(safe-area-inset-bottom)) max(8px, env(safe-area-inset-left));
				display: grid;
				grid-template-rows: 1fr auto;
				gap: 8px;
			}
			button {
				background: #1d2638;
				color: var(--text);
				border: 1px solid var(--line);
				border-radius: 8px;
				padding: 6px 9px;
				font: inherit;
				cursor: pointer;
			}
			#terminal-wrapper {
				background: #05070d;
				border: 1px solid var(--line);
				border-radius: 12px;
				overflow: hidden;
				min-height: 0;
				padding: 6px;
				min-width: 0;
			}
			#terminal {
				width: 100%;
				height: 100%;
				min-height: 0;
				min-width: 0;
			}
			#terminal .xterm {
				height: 100%;
			}
			#terminal .xterm-viewport {
				-webkit-overflow-scrolling: touch;
			}
			.detail {
				color: var(--muted);
				min-width: 0;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			.mobile-keybar {
				display: none;
				border: 1px solid var(--line);
				border-radius: 10px;
				padding: 6px;
				background: color-mix(in srgb, var(--panel) 92%, transparent);
				gap: 6px;
			}
			.mobile-keybar-row {
				display: grid;
				grid-template-columns: repeat(3, minmax(0, 1fr));
				gap: 6px;
			}
			.mobile-keybar button {
				min-height: 34px;
				padding: 6px 4px;
				font-size: 12px;
				border-radius: 7px;
				background: #152036;
			}
			.mobile-keybar .icon-button {
				font-size: 16px;
				font-weight: 700;
				padding-top: 2px;
			}
			body.mobile-ui-enabled .mobile-keybar {
				display: grid;
			}
			.panel-backdrop {
				position: fixed;
				inset: 0;
				background: #0000005c;
				opacity: 0;
				pointer-events: none;
				transition: opacity 120ms ease-out;
				z-index: 30;
			}
			.control-panel {
				position: fixed;
				right: 0;
				top: 0;
				height: 100%;
				width: min(420px, 88vw);
				padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right))
					max(12px, env(safe-area-inset-bottom)) 12px;
				background: color-mix(in srgb, #080d17 94%, transparent);
				border-left: 1px solid var(--line);
				display: grid;
				grid-template-rows: auto auto 1fr;
				gap: 10px;
				transform: translateX(102%);
				transition: transform 130ms ease-out;
				z-index: 40;
			}
			body.panel-open .panel-backdrop {
				opacity: 1;
				pointer-events: auto;
			}
			body.panel-open .control-panel {
				transform: translateX(0);
			}
			.panel-header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 8px;
				padding: 6px 2px;
			}
			.panel-header strong {
				font-size: 14px;
			}
			.panel-header button {
				min-width: 44px;
				min-height: 36px;
			}
			.panel-tabs {
				display: grid;
				grid-template-columns: repeat(2, minmax(0, 1fr));
				gap: 8px;
			}
			.panel-tab {
				min-height: 36px;
				border-radius: 8px;
				background: #142036;
			}
			.panel-tab.active {
				background: #22324d;
				border-color: #3d587f;
			}
			.panel-sections {
				min-height: 0;
				overflow: auto;
				-webkit-overflow-scrolling: touch;
				display: grid;
				gap: 12px;
				padding-bottom: 12px;
			}
			.panel-section[hidden] {
				display: none;
			}
			.panel-card {
				border: 1px solid var(--line);
				border-radius: 10px;
				background: #101827;
				padding: 10px;
				display: grid;
				gap: 8px;
			}
			.panel-card h3 {
				margin: 0;
				font-size: 13px;
			}
			.panel-hint {
				color: var(--muted);
				font-size: 11px;
				line-height: 1.4;
			}
			.panel-field {
				display: grid;
				gap: 4px;
			}
			.panel-field label {
				margin: 0;
				font-size: 11px;
				color: var(--muted);
			}
			.panel-field input {
				width: 100%;
				min-height: 34px;
				padding: 7px 9px;
				border-radius: 8px;
				border: 1px solid var(--line);
				background: #060a12;
				color: var(--text);
				font: inherit;
			}
			.panel-checkbox {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 12px;
			}
			.panel-checkbox input {
				width: 16px;
				height: 16px;
			}
			.panel-row {
				display: grid;
				grid-template-columns: repeat(2, minmax(0, 1fr));
				gap: 8px;
			}
			.panel-row-3 {
				display: grid;
				grid-template-columns: repeat(3, minmax(0, 1fr));
				gap: 8px;
			}
			.panel-list {
				display: grid;
				gap: 8px;
			}
			.panel-list-item {
				border: 1px solid var(--line);
				border-radius: 8px;
				background: #091120;
				padding: 8px;
				display: grid;
				gap: 6px;
			}
			.panel-list-item.active {
				border-color: #4f709e;
				background: #10223f;
			}
			.panel-item-title {
				font-size: 12px;
				font-weight: 600;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.panel-item-path {
				font-size: 11px;
				color: var(--muted);
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.panel-item-meta {
				font-size: 11px;
				color: var(--muted);
			}
			.panel-empty {
				font-size: 12px;
				color: var(--muted);
			}
			@media (max-width: 900px) {
				main {
					gap: 6px;
				}
				#terminal-wrapper {
					padding: 4px;
				}
				.control-panel {
					width: 92vw;
				}
			}
		</style>
	</head>
	<body>
		<main>
			<section id="terminal-wrapper">
				<div id="terminal"></div>
			</section>
			<section id="mobile-keybar" class="mobile-keybar" aria-label="Mobile terminal controls" aria-hidden="true">
				<div class="mobile-keybar-row">
					<button type="button" data-key="esc">Esc</button>
					<button type="button" data-key="up">Up</button>
					<button type="button" data-key="down">Down</button>
				</div>
				<div class="mobile-keybar-row">
					<button id="menu-toggle" type="button" title="Session menu" aria-label="Session menu">Menu</button>
					<button id="reconnect" class="icon-button" type="button" title="Reconnect" aria-label="Reconnect">â†»</button>
					<button type="button" data-key="enter">Enter</button>
				</div>
			</section>
		</main>
		<div id="panel-backdrop" class="panel-backdrop"></div>
		<aside id="control-panel" class="control-panel" aria-label="Session controls" aria-hidden="true">
			<div class="panel-header">
				<strong>Session Menu</strong>
				<button id="menu-close" type="button" aria-label="Close menu">Close</button>
			</div>
			<div class="panel-tabs" role="tablist" aria-label="Menu tabs">
				<button class="panel-tab active" id="tab-session" type="button" data-panel-tab="session" role="tab" aria-selected="true">
					Session
				</button>
				<button class="panel-tab" id="tab-repos" type="button" data-panel-tab="repos" role="tab" aria-selected="false">
					Repos
				</button>
			</div>
			<div class="panel-sections">
				<section id="panel-session" class="panel-section" data-panel-section="session" role="tabpanel" aria-labelledby="tab-session">
					<div class="panel-card">
						<h3>Status</h3>
						<div id="panel-status-text" class="panel-empty">Unknown</div>
						<div id="panel-active-session" class="panel-item-meta"></div>
						<div class="panel-row">
							<button id="panel-start-session" type="button">Start</button>
							<button id="panel-stop-session" type="button">Stop</button>
						</div>
						<div class="panel-row">
							<button id="panel-restart-session" type="button">Restart</button>
							<button id="panel-refresh" type="button">Refresh</button>
						</div>
					</div>
					<div class="panel-card">
						<h3>Defaults</h3>
						<div class="panel-field">
							<label for="panel-provider-input">Provider</label>
							<input id="panel-provider-input" type="text" placeholder="openrouter" />
						</div>
						<div class="panel-field">
							<label for="panel-model-input">Model</label>
							<input id="panel-model-input" type="text" placeholder="z-ai/glm-4.7" />
						</div>
						<label class="panel-checkbox" for="panel-no-session">
							<input id="panel-no-session" type="checkbox" />
							<span>Use <code>--no-session</code></span>
						</label>
						<div class="panel-hint">Start uses selected repo if one is active, otherwise host working directory.</div>
					</div>
					<div class="panel-card">
						<h3>Saved Sessions</h3>
						<div class="panel-hint">Uses selected repo from the Repos tab.</div>
						<div id="panel-saved-session-list" class="panel-list"></div>
					</div>
				</section>
				<section
					id="panel-repos"
					class="panel-section"
					data-panel-section="repos"
					role="tabpanel"
					aria-labelledby="tab-repos"
					hidden
				>
					<div class="panel-card">
						<h3>Selected Repo</h3>
						<div id="panel-selected-project" class="panel-empty">No repo selected.</div>
					</div>
					<div class="panel-card">
						<h3>Add Repo</h3>
						<div class="panel-field">
							<label for="panel-project-path">Path</label>
							<input id="panel-project-path" type="text" placeholder="~/dev/my-repo" />
						</div>
						<div class="panel-field">
							<label for="panel-project-id">ID (optional)</label>
							<input id="panel-project-id" type="text" placeholder="my-repo" />
						</div>
						<button id="panel-project-add" type="button">Add Repo</button>
					</div>
					<div class="panel-card">
						<h3>Repos</h3>
						<div id="panel-project-list" class="panel-list"></div>
					</div>
					<div class="panel-card">
						<h3>Recent Sessions</h3>
						<div id="panel-recent-list" class="panel-list"></div>
					</div>
				</section>
			</div>
		</aside>

		<script src="/vendor/xterm.js"></script>
		<script src="/vendor/xterm-addon-fit.js"></script>
		<script>
			window.__PI_WEB_BOOTSTRAP__ = __PI_WEB_BOOTSTRAP_JSON__;
		</script>
		<script type="module" src="/app.js"></script>
	</body>
</html>
